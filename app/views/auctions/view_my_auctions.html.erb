<% content_for :login_path do %><%= auctions_login_path %><% end %>
<% content_for :page_nav do %><%= link_to "Auctions", auctions_path, style: "color:#A6A6A6;margin-left:10px;" %><% end %>
<% content_for :logged_in_page_nav do %><% end %>

<h1>My Auctions</h1>
<%= link_to "Create Speedy Auction", new_item_path, :class => "btn btn-primary"  %><br />
<ul class="nav nav-tabs" data-tabs="tabs">
	<li class="active"><a href="#1" data-toggle="tab">My Queued Speedy Auctions</a></li>
	<li><a href="#2" data-toggle="tab">My Sold Speedy Auctions</a></li>
	<li><a href="#3" data-toggle="tab">My Purchased Speedy Auctions</a></li>
</ul>
<div class="tab-content">
	<div class="tab-pane active" id="1">
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Item</th>
					<th>Description</th>
					<th>Beginning Date</th>
					<th>End Date</th>
					<th>Current Price</th>
				</tr>
			</thead>
			<tbody>
				<% @future_items.each do |item| %>
					<% @future_auctions.each do |auction| %>
						<% if item != nil && auction != nil && auction.item == item && @user.id == item.user_id %>
							<tr class='clickable-row' data-href='<%= view_auction_path(auction.id)%>'>
								<td><%= item.name %> <%= image_tag item.headline_image.url%><% if auction.begin_date < DateTime.now %> Currently Going!<%end%></td>
								<td><%= item.description %></td>
								<td><%= auction.begin_date.month%>-<%= auction.begin_date.day%>-<%= auction.begin_date.year%></td>
								<td><%= auction.end_date.month%>-<%= auction.end_date.day%>-<%= auction.end_date.year%></td>
								<td><%= number_to_currency(auction.current_bid)%></td>
								<td><%= link_to 'Cancel', item, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-primary" %></td>
							</tr>
						<% end %>  
					<% end %>
				<% end %>
			</tbody>
		</table>
	</div>
	<div class="tab-pane" id="2">
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Item</th>
					<th>Description</th>
					<th>Beginning Date</th>
					<th>End Date</th>
					<th>Sold price</th>
				</tr>
			</thead>
			<tbody>
				<% @past_items.each do |item| %>
					<% @past_auctions.each do |auction| %>
						<% if item != nil && auction != nil && auction.item == item && @user.id == item.user_id%>
							<tr class='clickable-row' data-href='<%= view_auction_path(auction.id)%>'>
								<td><%= item.name %> <%= image_tag item.headline_image.url%></td>
								<td><%= item.description %></td>
								<td><%= auction.begin_date.month%>-<%= auction.begin_date.day%>-<%= auction.begin_date.year%></td>
								<td><%= auction.end_date.month%>-<%= auction.end_date.day%>-<%= auction.end_date.year%></td>
								<td><%= number_to_currency(auction.current_bid) %></td>
							</tr>
						<% end %>
					<% end %>
				<% end %>
			</tbody>
		</table>
	</div>
	<div class="tab-pane" id="3">
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Item</th>
					<th>Description</th>
					<th>Beginning Date</th>
					<th>End Date</th>
					<th>Sold price</th>
				</tr>
			</thead>
			<tbody>
				<% @past_items.each do |item| %>
					<% @past_auctions.each do |auction| %>
						<% if item != nil && auction != nil && auction.item == item && @user.id == auction.bidder_id%>
							<tr class='clickable-row' data-href='<%= view_auction_path(auction.id)%>'>
								<td><%= item.name %> <%= image_tag item.headline_image.url%></td>
								<td><%= item.description %></td>
								<td><%= auction.begin_date.month%>-<%= auction.begin_date.day%>-<%= auction.begin_date.year%></td>
								<td><%= auction.end_date.month%>-<%= auction.end_date.day%>-<%= auction.end_date.year%></td>
								<td><%= number_to_currency(auction.current_bid) %></td>
							</tr>
						<% end %> 
					<% end %>
				<% end %>
			</tbody>
		</table>
	</div>
</div>


<script type="text/javascript">
	$(document).ready(function($) {
		$(".clickable-row").click(function() {
			document.location = $(this).data("href");
		});
	});
</script>
